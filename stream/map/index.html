<!doctype html>
<html>
<head>
	<title>Latitude Map &#187; Miguel Mota | Feelance Web Developer</title>
	<link rel='shortcut icon' href='http://www.miguelmota.com/favicon.ico' />
	<link href='/styles/reset.min.css' rel='stylesheet' />
	<script src='http://code.jquery.com/jquery.min.js'></script>
	<script src='http://maps.google.com/maps/api/js?sensor=false'></script>
	<script>
		$(document).ready(function(){
			
		

		$.ajax({
		    url: 'https://www.googleapis.com/latitude/v1/currentLocation?access_token=ya29.AHES6ZS7sr59rx_Bb9MIiFXJReAEJ7ExQpE7bQxESYugBG85oLkRMg&callback=?',
		    type: 'get',
		    dataType: 'json',
		    cache: false,
		    crossDomain: true,
		    success: function (data) {
		        var data = data.data;
		        var lat = data.latitude;
		        var lng = data.longitude;
		        var timestamp = data.timestampMs;

		        var geocoder = new google.maps.Geocoder();
		        var latlng = new google.maps.LatLng(lat,lng);

		        geocoder.geocode(
		            {'latLng'  : latlng }, 
		            function(results, status) {
		                if (status == google.maps.GeocoderStatus.OK) {
		                    var current_location = null;
		                    if (results[1]) {
		                       current_location = results[1].formatted_address;
		                    }
		                    else if (results[6]) {
		                       current_location = results[6].formatted_address;
		                    }
		                    else {
		                        current_location = "unable to retrieve location";
		                    }

		        			//var date = formattedDateUnix(timestamp);

		        			//map
		        			var latlng = new google.maps.LatLng(lat+","+lng);
		        			var infowindow = new google.maps.InfoWindow({
		        				content: ""
		        			});

		        			var myOptions = {
		        					zoom: 9,
		        					center: latlng,
		        					mapTypeId: google.maps.MapTypeId.ROADMAP
		        				};

		        			var map = new google.maps.Map(document.getElementById('gmap'), myOptions);
		        			var photo_url = 'http://www.miguelmota.com/assets/stream/map/marker-miguelmota.png';

		        			var htmlContent = "<div class='gmap-infowindow'>"+
		        			"<span class='gmap-infowindow-location'>"+current_location+"</span>"+
		        			"<span class='gmap-infowindow-coords'>"+lat+","+lng+"</span>" +
		        			"<span class='gmap-infowindow-time'>"+timestamp+"</span></div>";

		        			var image = new google.maps.MarkerImage(photo_url);

		        			var marker = new google.maps.Marker({
		        					position: latlng,
		        					map: map,
		        					icon: image,
		        					title: current_location,
		        					html: htmlContent
		        				});

		        			google.maps.event.addListener(marker, 'click', function() {
		        				infowindow.setContent(this.html);
		        				infowindow.open(map, this);
		        				map.setZoom(16);
		        				map.panTo(marker.position);
		        			});
		        			
		        			marker.setAnimation(google.maps.Animation.DROP);
		                }
		            }
		         );
		    }
		});

});
	</script>
	<style>
	html, body {
		height: 100%;
		width: 100%;
	}
	#gmap {
		height: 100%;
		width: 100%;
	}
	.gmap-infowindow {
		overflow: hidden;
	}
	.gmap-infowindow-location {
		color: #333;
		display: block;
		font-size: 16px;
		font-weight: bold;
		margin: 0 0 5px 0;
	}
	.gmap-infowindow-coords {
		color: #999;
		display: block;
	}
	.gmap-infowindow-time {
		color: #555;
		display: block;
	}
	</style>
</head>
<body>
	<div id='gmap'>loading</div>
</body>
</html>