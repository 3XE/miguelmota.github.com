<!DOCTYPE html>
<html lang="en-US" manifest="http://cache.miguelmota.com/cache.appcache">
<head>
  <meta charset="UTF-8">
  <!--
                                        ___                           __
             __                        /\_ \                         /\ \__
    ___ ___ /\_\     __   __  __     __\//\ \         ___ ___     ___\ \ ,_\    __
  /' __` __`\/\ \  /'_ `\/\ \/\ \  /'__`\\ \ \      /' __` __`\  / __`\ \ \/  /'__`\
  /\ \/\ \/\ \ \ \/\ \L\ \ \ \_\ \/\  __/ \_\ \_    /\ \/\ \/\ \/\ \L\ \ \ \_/\ \L\.\_
  \ \_\ \_\ \_\ \_\ \____ \ \____/\ \____\/\____\   \ \_\ \_\ \_\ \____/\ \__\ \__/.\_\
   \/_/\/_/\/_/\/_/\/___L\ \/___/  \/____/\/____/    \/_/\/_/\/_/\/___/  \/__/\/__/\/_/
                     /\____/
                     \_/__/
  -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="description" content="Take webcam screenshots with the getUserMedia JavaScript API.">
  <meta name="keywords" content="miguel mota,web developer,html5 css3 javascript">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Moogs">
  <title>Screenshots with getUserMedia API » Miguel Mota | Web Developer</title>
  <link rel="canonical" href="http://www.miguelmota.com/blog/screenshots-with-getusermedia-api/">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/miguelmota">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/images/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png">
  <link rel="apple-touch-startup-image" media="(device-width: 320px)" href="/assets/images/apple-touch-startup-image-320x460.png">
  <link rel="apple-touch-startup-image" media="(device-width: 320px) and (-webkit-device-pixel-ratio: 2)" href="/assets/images/apple-touch-startup-image-640x920.png">
  <link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/assets/images/apple-touch-startup-image-640x1096.png">
  <link rel="apple-touch-startup-image" media="(device-width: 768px) and (orientation: portrait)" href="/assets/images/apple-touch-startup-image-768x1004.png">
  <link rel="apple-touch-startup-image" media="(device-width: 768px) and (orientation: landscape)" href="/assets/images/apple-touch-startup-image-748x1024.png">
  <link rel="apple-touch-startup-image" media="(device-width: 1536px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/assets/images/apple-touch-startup-image-1536x2008.png">
  <link rel="apple-touch-startup-image" media="(device-width: 1536px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/assets/images/apple-touch-startup-image-2048x1496.png">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="//use.typekit.net/wkl5rpy.js"></script>
  <script>try{Typekit.load();}catch(e){}</script>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  <script src="/assets/scripts/build/site.js"></script>
  <script>
      var _gaq = _gaq || [];
       _gaq.push(['_setAccount', 'UA-12642068-1']);
       _gaq.push(['_setDomainName', '.miguelmota.com']);
      _gaq.push(['_trackPageview']);
       (function() {
           var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
           ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
           var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
       $(document).on('click', '[data-ga-label]', function() {
         _gaq.push(['_trackEvent', 'Call To Action', 'Click', $(this).attr('data-ga-label')]);
       });
  </script>
</head>
<body id="blog">
    <canvas id="bg-canvas"></canvas>
    <div class="bg-upper"></div>
    <div class="bg-lower"></div>
    <div id="top"></div>
    <img class="hidden" src="/assets/images/miguel-mota-m-logo-500x500.png" alt="">

    <header id="header" class="contain-to-grid fixed">
      <nav class="top-bar">
        <ul class="title-area">
          <li class="name"><a href="/" data-ga-label="Navigation - Logo">Miguel Mota</a></li>
          <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
        </ul>
        <section class="top-bar-section">
            <ul id="main-nav" class="right">
              <li class="divider"></li>
              <li ><a href="/" data-ga-label="Navigation - Home"><i class="fa fa-home"></i></a></li>
              <li class="divider"></li>
              <li ><a href="/about" data-ga-label="Navigation - About"><i class="fa fa-bookmark-o"></i> About</a></li>
              <li class="divider"></li>
              <li class="active"><a href="/blog" data-ga-label="Navigation - Blog"><i class="fa fa-lightbulb-o"></i> Thoughts</a></li>
              <li class="divider"></li>
              <li ><a href="/work" data-ga-label="Navigation - Work"><i class="fa fa-laptop"></i> Work</a></li>
              <li class="divider"></li>
              <li ><a href="/contact" data-ga-label="Navigation - Contact"><i class="fa fa-envelope-o"></i> Contact</a></li>
              <li class="divider"></li>
            </ul>
        </section>
      </nav>
    </header>

    <main id="main" role="main">
      <header id="content-header">
    
    <div class="row">
        <div class="large-12 column">
          
            <datetime>31 Aug 2013 <small><i class="fa fa-comment-o"></i> <a href="/blog/screenshots-with-getusermedia-api/#disqus_thread" data-disqus-identifier="/blog/screenshots-with-getusermedia-api/"></a></small> <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.miguelmota.com/blog/screenshots-with-getusermedia-api/" data-text="Screenshots with getUserMedia API" data-size="large" data-related="_moogs" data-ga-label="Blog post - Tweet">Tweet</a></datetime>
<h1 data-text="Screenshots with getUserMedia API">Screenshots with getUserMedia API</h1>

          
        </div>
    </div>
    <div id="content-header-bottom">
        <div class="triangle"></div>
    </div>
</header>


<section id="post">
  <div class="row">
    <div class="large-12 column">

      <p>With the <code>getUserMedia</code> API, it is now possible to access the user&#39;s webcam and microphone using just JavaScript. What this means is that we can finally get rid of those nasty Flash plugins and use this native approace instead. At the writing of this post, only Firefox 17+ and Chrome 21+ have <a href="http://caniuse.com/stream">support for getUserMedia</a>.</p>

<p>Give credit where credit is due. The code is heavily inspired by HTML5 Rocks&#39; article <em><a href="http://www.html5rocks.com/en/tutorials/getusermedia/intro/">Capturing Audio &amp; Video in HTML5</a></em>.</p>

<p><a href="/blog/screenshots-with-getusermedia-api//demo">View the demo »</a></p>

<p>I tried explaining what the code does in the comments, but anyhow let me give a quick rundown of the code. First we create an object to hold everything that deals with the whole process of streaming and capturing. At the top, we grab our DOM elements and have an initialize function that checks for getUserMedia support. If there is support then call the gotStream function to start outputting the live stream into the video element. So that&#39;s that. There&#39;s a capture button binded to the capture method, which when called, will grab the current frame of the live video and draw that image onto the canvas element. We then turn the canvas image into a base 64 data url so that we can send it to our server, which will ultimately decode the data url and save it as a PNG image. Afterwards we simply return the saved image url. In the demo I am using PHP to decode the data url but any server side language will do I imagine.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- Video element (live stream) --&gt;</span>
<span class="nt">&lt;label&gt;</span>Video Stream<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;video</span> <span class="na">autoplay</span> <span class="na">id=</span><span class="s">&quot;video&quot;</span> <span class="na">width=</span><span class="s">&quot;640&quot;</span> <span class="na">height=</span><span class="s">&quot;480&quot;</span><span class="nt">&gt;&lt;/video&gt;</span>

<span class="c">&lt;!-- Canvas element (screenshot) --&gt;</span>
<span class="nt">&lt;label&gt;</span>Screenshot (base 64 dataURL)<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;canvas&quot;</span> <span class="na">width=</span><span class="s">&quot;640&quot;</span> <span class="na">height=</span><span class="s">&quot;480&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>

<span class="c">&lt;!-- Capture button --&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">&quot;capture-btn&quot;</span><span class="nt">&gt;</span>Capture!<span class="nt">&lt;/button&gt;</span>

<span class="c">&lt;!-- Image URL output --&gt;</span>
<span class="nt">&lt;label&gt;</span>Image URL<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">id=</span><span class="s">&quot;image-url-input&quot;</span> <span class="na">disabled</span><span class="nt">&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// Our element ids.</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">video</span><span class="o">:</span> <span class="s1">&#39;#video&#39;</span><span class="p">,</span>
    <span class="nx">canvas</span><span class="o">:</span> <span class="s1">&#39;#canvas&#39;</span><span class="p">,</span>
    <span class="nx">captureBtn</span><span class="o">:</span> <span class="s1">&#39;#capture-btn&#39;</span><span class="p">,</span>
    <span class="nx">imageURLInput</span><span class="o">:</span> <span class="s1">&#39;#image-url-input&#39;</span>
  <span class="p">};</span>

  <span class="c1">// Our object that will hold all of the functions.</span>
  <span class="kd">var</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Get the video element.</span>
    <span class="nx">video</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">video</span><span class="p">),</span>
    <span class="c1">// Get the canvas element.</span>
    <span class="nx">canvas</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">canvas</span><span class="p">),</span>
    <span class="c1">// Get the canvas context.</span>
    <span class="nx">ctx</span><span class="o">:</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">),</span>
    <span class="c1">// Get the capture button.</span>
    <span class="nx">captureBtn</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">captureBtn</span><span class="p">),</span>
    <span class="c1">// This will hold the video stream.</span>
    <span class="nx">localMediaStream</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="c1">// This will hold the screenshot base 64 data url.</span>
    <span class="nx">dataURL</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="c1">// This will hold the converted PNG url.</span>
    <span class="nx">imageURL</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="c1">// Get the input field to paste in the imageURL.</span>
    <span class="nx">imageURLInput</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">imageURLInput</span><span class="p">),</span>

    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="c1">// Check if navigator object contains getUserMedia object.</span>
      <span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span> <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">webkitGetUserMedia</span> <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">mozGetUserMedia</span> <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">msGetUserMedia</span><span class="p">;</span>
      <span class="c1">// Check if window contains URL object.</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span><span class="p">;</span>

      <span class="c1">// Check for getUserMedia support.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Get video stream.</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span>
          <span class="nx">video</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">gotStream</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">noStream</span><span class="p">);</span>

        <span class="c1">// Bind capture button to capture method.</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">captureBtn</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">that</span><span class="p">.</span><span class="nx">capture</span><span class="p">();</span>
        <span class="p">};</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// No getUserMedia support.</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Your browser does not support getUserMedia API.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="c1">// Stream error.</span>
    <span class="nx">noStream</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Could not get camera stream.&#39;</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// Stream success.</span>
    <span class="nx">gotStream</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Feed webcam stream to video element.</span>
      <span class="c1">// IMPORTANT: video element needs autoplay attribute or it will be frozen at first frame.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">;</span> <span class="c1">// Opera support.</span>
      <span class="p">}</span>

      <span class="c1">// Store the stream.</span>
      <span class="nx">localMediaStream</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="c1">// Capture frame from live video stream.</span>
    <span class="nx">capture</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="c1">// Check if has stream.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">localMediaStream</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Draw whatever is in the video element on to the canvas.</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">video</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">// Create a data url from the canvas image.</span>
        <span class="nx">dataURL</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s1">&#39;image/png&#39;</span><span class="p">);</span>
        <span class="c1">// Call our method to save the data url to an image.</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">saveDataUrlToImage</span><span class="p">();</span>
       <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">saveDataUrlToImage</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// Change this to your own url.</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://example.com/dataurltoimage&#39;</span>
      <span class="p">};</span>

      <span class="c1">// Only place where we need jQuery to make an ajax request</span>
      <span class="c1">// to our server to convert the dataURL to a PNG image,</span>
      <span class="c1">// and return the url of the converted image.</span>
      <span class="nx">that</span><span class="p">.</span><span class="nx">imageURLInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;Fetching url ...&#39;</span><span class="p">;</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="s1">&#39;data_url&#39;</span><span class="o">:</span> <span class="nx">dataURL</span> <span class="p">},</span>
        <span class="nx">complete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Request complete.</span>
        <span class="p">},</span>
        <span class="c1">// Request was successful.</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Response: &#39;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
          <span class="c1">// Conversion successful.</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status_code</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">imageURL</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">image_url</span><span class="p">;</span>
            <span class="c1">// Paste the PNG image url into the input field.</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">imageURLInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">imageURL</span><span class="p">;</span>
                                                <span class="nx">that</span><span class="p">.</span><span class="nx">imageURLInput</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// Some error occured.</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span><span class="p">,</span> <span class="nx">errorThrown</span><span class="p">);</span>
          <span class="nx">imageURLInput</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;An error occured.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>

  <span class="p">};</span>

  <span class="c1">// Initialize our application.</span>
  <span class="nx">App</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>

  <span class="c1">// Expose to window object for testing purposes.</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">App</span> <span class="o">=</span> <span class="nx">App</span><span class="p">;</span>

<span class="p">})();</span>
</code></pre></div><div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
  <span class="c1">// Data URL to image.</span>

  <span class="c1">// exit immediately if the data url was not passed.</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;data_url&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">exit</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// Get the data url.</span>
  <span class="nv">$img</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;data_url&#39;</span><span class="p">];</span>

  <span class="c1">// Clean up the data url string a bit.</span>
  <span class="nv">$img</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;data:image/png;base64,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$img</span><span class="p">);</span>
  <span class="nv">$img</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nv">$img</span><span class="p">);</span>

  <span class="c1">// Decode the image.</span>
  <span class="nv">$decodedImage</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$img</span><span class="p">);</span>

  <span class="c1">// Generate a random filename.</span>
  <span class="nv">$filename</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">time</span><span class="p">())</span><span class="o">.</span><span class="s1">&#39;.png&#39;</span><span class="p">;</span>

  <span class="c1">// Save the file to the server and generate a response.</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;DOCUMENT_ROOT&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/uploads/&#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$decodedImage</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$imageURL</span> <span class="o">=</span> <span class="s1">&#39;http://&#39;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/uploads/&#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;status_code&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">,</span>
      <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;image_url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$imageURL</span>
      <span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
      <span class="s1">&#39;status_code&#39;</span> <span class="o">=&gt;</span> <span class="mi">500</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Return JSON response.</span>
  <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>
  <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>Get this <a href="https://gist.github.com/miguelmota/6403122">gist.</a></p>

<p><a href="/blog/screenshots-with-getusermedia-api//demo">View the demo »</a></p>

<h2 id="update-05-jan-2015">Update 05 Jan 2015</h2>

<p>Moved to a <a href="https://github.com/miguelmota/getUserMedia-demo">repo on Github</a>, with a <a href="http://nodejs.org/">Node.js</a> server instead of PHP.</p>


      <div class="tags">
  
    <a href="/tag/HTML5">#HTML5</a>
  
    <a href="/tag/JavaScript">#JavaScript</a>
  
    <a href="/tag/getUserMedia">#getUserMedia</a>
  
    <a href="/tag/demo">#demo</a>
  
</div>


    </div>
  </div>

  
    <div id="related-posts" class="row">
      <div class="large-6 column">
        
    

    <h3>Previous post</h3>

      <dl class="posts-list">
        <dt><datetime>07 Jul 2013</datetime></dt>
        <dd><h2><a href="/blog/basic-html5-audio-manipulation/">Basic HTML5 Audio Manipulation</a> <small><i class="icon-comment-alt"></i> <a href="/blog/basic-html5-audio-manipulation/#disqus_thread" data-disqus-identifier="/blog/basic-html5-audio-manipulation/"></a></small></h2></dd>
      </dl>

    



    

      <h3>Next post</h3>

      <dl class="posts-list">
        <dt><datetime>25 Sep 2013</datetime></dt>
        <dd><h2><a href="/blog/raspberry-pi-camera-board-video-streaming/">Raspberry Pi camera board video streaming</a> <small><i class="icon-comment-alt"></i> <a href="/blog/raspberry-pi-camera-board-video-streaming/#disqus_thread" data-disqus-identifier="/blog/raspberry-pi-camera-board-video-streaming/"></a></small></h2></dd>
      </dl>

    

      </div>
      <div class="large-6 column">

        <h3>See also...</h3>

        <dl class="posts-list">
          
            <dt><datetime>01 Feb 2015</datetime></dt>
<dd><h2><a href="/blog/pixelate-images-with-canvas/">Pixelate images with canvas</a> <small><i class="icon-comment-alt"></i> <a href="/blog/pixelate-images-with-canvas/#disqus_thread" data-disqus-identifier="/blog/pixelate-images-with-canvas/"></a></small></h2>
</dd>
          
            <dt><datetime>19 Jul 2014</datetime></dt>
<dd><h2><a href="/blog/bitwise-operators-in-javascript/">Bitwise operators in JavaScript</a> <small><i class="icon-comment-alt"></i> <a href="/blog/bitwise-operators-in-javascript/#disqus_thread" data-disqus-identifier="/blog/bitwise-operators-in-javascript/"></a></small></h2>
</dd>
          
            <dt><datetime>20 Jun 2014</datetime></dt>
<dd><h2><a href="/blog/es6-examples/">ES6 Examples</a> <small><i class="icon-comment-alt"></i> <a href="/blog/es6-examples/#disqus_thread" data-disqus-identifier="/blog/es6-examples/"></a></small></h2>
</dd>
          
            <dt><datetime>14 Mar 2014</datetime></dt>
<dd><h2><a href="/blog/deployment-with-git/">Deployment with Git</a> <small><i class="icon-comment-alt"></i> <a href="/blog/deployment-with-git/#disqus_thread" data-disqus-identifier="/blog/deployment-with-git/"></a></small></h2>
</dd>
          
            <dt><datetime>23 Jan 2014</datetime></dt>
<dd><h2><a href="/blog/intro-to-redis/">Intro to Redis</a> <small><i class="icon-comment-alt"></i> <a href="/blog/intro-to-redis/#disqus_thread" data-disqus-identifier="/blog/intro-to-redis/"></a></small></h2>
</dd>
          
        </dl>

      </div>
    </div>
  

  <div id="comments" class="row">
    <div class="large-12 column">
      <div id="disqus_thread"></div>
    </div>
  </div>

</section>

<script>
    var disqus_shortname = 'miguelmota';
    var disqus_identifier = '/blog/screenshots-with-getusermedia-api/';
    var disqus_url = 'http://www.miguelmota.com/blog/screenshots-with-getusermedia-api/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    </main>

    <footer id="footer">
      <div class="row">
        <div class="large-12 column">
          <p>
            <span class="break"><span>© 2015 Moogs™.</span> <span>Made with <i class="fa fa-heart"></i></span></span> <a class="hidden" href="https://plus.google.com/102174577273194387652" rel="author">Google+</a>

            <a href="https://twitter.com/_moogs" class="twitter-follow-button" data-show-count="true" data-size="large" data-ga-label="Footer - Follow Twitter">Follow @_moogs</a>

          </p>
        </div>
      </div>
    </footer>

    <a id="forkme" href="https://github.com/miguelmota/miguelmota.github.com" target="_blank" data-ga-label="Fork me on Github"><img src="/assets/images/forkme_right_darkblue_121621.png" alt=""></a>

    <script src="//maps.google.com/maps/api/js?sensor=false"></script>
    <script src="//google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js"></script>
  </body>
</html>
